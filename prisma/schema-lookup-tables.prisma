// ============================================================================
// LOOKUP TABLES - Replaces all enums with flexible lookup tables
// ============================================================================

// Generic Lookup Table Model (can be used for all enums)
model LookupTable {
  id          String   @id @default(cuid())
  category    String   // e.g., "user_status", "kyc_status", "property_type"
  code        String   // e.g., "ACTIVE", "PENDING", "APARTMENT"
  label       String   // Display name
  description String?  // Optional description
  sortOrder   Int      @default(0)
  isActive    Boolean  @default(true)
  metadata    Json?    // Additional flexible data
  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt

  @@unique([category, code])
  @@index([category])
  @@index([category, isActive])
  @@map("lookup_tables")
}

// Seed data script will populate this table with all enum values
// Example categories:
// - user_status: ACTIVE, SUSPENDED, BANNED, DEACTIVATED
// - kyc_status: PENDING, IN_REVIEW, APPROVED, REJECTED, REQUIRES_UPDATE
// - property_type: APARTMENT, HOUSE, VILLA, etc.
// - booking_status: PENDING, CONFIRMED, CANCELLED, etc.
// ... and 37 more categories

// ============================================================================
// UPDATED MODEL EXAMPLES (showing how to use lookup tables)
// ============================================================================

// Example: User model with lookup table references
model UserExample {
  id            String   @id @default(cuid())
  firstName     String
  lastName      String
  email         String   @unique

  // OLD: accountStatus  UserStatus  @default(ACTIVE)
  // NEW: Use foreign key to lookup table
  accountStatusCode String   @default("ACTIVE")
  accountStatus     LookupTable @relation("UserAccountStatus", fields: [accountStatusCode], references: [code])

  // OLD: kycStatus     KycStatus   @default(PENDING)
  // NEW: Use foreign key to lookup table
  kycStatusCode     String   @default("PENDING")
  kycStatus         LookupTable @relation("UserKycStatus", fields: [kycStatusCode], references: [code])

  @@map("users_example")
}

// ============================================================================
// MIGRATION STRATEGY
// ============================================================================

/*
STEP 1: Add lookup table to schema
---------------------------------------
- Add LookupTable model above
- Keep existing enums temporarily

STEP 2: Seed lookup table with data
---------------------------------------
Run: npx prisma db seed

Example seed data:
  await prisma.lookupTable.createMany({
    data: [
      // User Statuses
      { category: 'user_status', code: 'ACTIVE', label: 'Active', sortOrder: 1 },
      { category: 'user_status', code: 'SUSPENDED', label: 'Suspended', sortOrder: 2 },
      { category: 'user_status', code: 'BANNED', label: 'Banned', sortOrder: 3 },
      { category: 'user_status', code: 'DEACTIVATED', label: 'Deactivated', sortOrder: 4 },

      // KYC Statuses
      { category: 'kyc_status', code: 'PENDING', label: 'Pending', sortOrder: 1 },
      { category: 'kyc_status', code: 'IN_REVIEW', label: 'In Review', sortOrder: 2 },
      { category: 'kyc_status', code: 'APPROVED', label: 'Approved', sortOrder: 3 },
      { category: 'kyc_status', code: 'REJECTED', label: 'Rejected', sortOrder: 4 },

      // ... repeat for all 40 enum categories
    ]
  });

STEP 3: Add new fields alongside old ones
---------------------------------------
For each model with enum:
- Add new String field (e.g., accountStatusCode)
- Add relation to LookupTable
- Keep old enum field temporarily

STEP 4: Migrate existing data
---------------------------------------
Copy enum values to new string fields:
  await prisma.$executeRaw`
    UPDATE users SET account_status_code = account_status::text
  `

STEP 5: Update application code
---------------------------------------
Update all references from:
  user.accountStatus === UserStatus.ACTIVE
To:
  user.accountStatusCode === 'ACTIVE'
  // or
  user.accountStatus.code === 'ACTIVE'

STEP 6: Remove old enum fields
---------------------------------------
- Drop old enum columns
- Drop enum types
- Remove from Prisma schema

STEP 7: Redeploy and test
---------------------------------------
- Test all queries
- Verify data integrity
- Monitor for errors
*/

// ============================================================================
// BENEFITS OF LOOKUP TABLES
// ============================================================================

/*
✅ Flexibility: Add/modify/remove values without schema migrations
✅ Internationalization: Can add translations to metadata
✅ Audit Trail: Track when values were added/modified
✅ Soft Delete: Can deactivate instead of delete
✅ Ordering: Control display order with sortOrder
✅ Metadata: Store additional info in JSON field
✅ Consistency: Single source of truth for all enums
✅ Performance: Indexes on category + isActive for fast lookups

EXAMPLE QUERIES:
----------------

// Get all active property types
const propertyTypes = await prisma.lookupTable.findMany({
  where: {
    category: 'property_type',
    isActive: true
  },
  orderBy: { sortOrder: 'asc' }
});

// Get specific lookup value
const activeStatus = await prisma.lookupTable.findUnique({
  where: {
    category_code: {
      category: 'user_status',
      code: 'ACTIVE'
    }
  }
});

// Update user with lookup table
await prisma.user.update({
  where: { id: userId },
  data: {
    accountStatusCode: 'SUSPENDED'
  }
});

// Query with related lookup data
const users = await prisma.user.findMany({
  include: {
    accountStatus: true,  // Gets full lookup table record
    kycStatus: true
  }
});
*/
